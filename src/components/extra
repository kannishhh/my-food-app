import Shimmer from "./Shimmer";
import { useParams } from "react-router-dom";
import useRestaurantMenu from "../utils/useRestaurantMenu";
import withBestSeller from "./withBestSeller";
import MenuItemCard from "./MenuItemCard";



const BestSellerMenuItemCard = withBestSeller(MenuItemCard);

const RestaurantMenu = () => {
  const { resId } = useParams();

  const restInfo = useRestaurantMenu(resId);

  if (restInfo === null) return <Shimmer />;

  const {
    name,
    cuisines,
    costForTwoMessage,
    avgRating,
    areaName,
    sla,
    totalRatingsString,
  } = restInfo?.cards[2]?.card?.card?.info;

  // Find the grouped card section
  const regularCards = restInfo?.cards?.find(
    (card) => card?.groupedCard?.cardGroupMap?.REGULAR
  )?.groupedCard?.cardGroupMap?.REGULAR?.cards;

  return (
    <div className="p-6 max-w-4xl mx-auto">
      {/* {header section} */}
      <div className="border-b pb-6 mb-6">
        <h1 className="text-3xl font-bold">{name}</h1>
        <div className="flex space-x-4 mt-2">
          <span className="text-orange-500 font-semibold border-b-2 border-orange-600 pb-1 cursor-pointer">
            Order Online
          </span>
          <span className="text-gray-500 cursor-pointer hover:text-orange-500">
            Dineout
          </span>
        </div>

        <div className="flex flex-col md:flex-row justify-between mt-4 text-sm text-gray-700">
          <div className="flex space-x-2 items-center">
            <span className="text-green-600 font-semibold">
              <i className="fa-solid fa-star mr-1"></i> {avgRating} (
              {totalRatingsString})
            </span>{" "}
            <span className="mx-1 text-gray-400">•</span>
            <span>{costForTwoMessage}</span>
          </div>

          <div className="mt-2 md:mt-0text-sm text-gray-600">
            <div>{cuisines.join(", ")}</div>
            <div className="flex space-x-2 mt-1">
              <span className="text-black font-semibold">Outlet</span>
              <span>{areaName}</span>
              <span className="mx-1 text-gray-400">•</span>
              <span>{sla?.slaString}</span>
            </div>
          </div>
        </div>
      </div>

      {/* Menu Section -- Loop through all sections */}
      {regularCards?.map((card, index) => {
        const section = card?.card?.card;

        if (section?.itemCards?.length > 0 && section?.title) {
          return (
            <div key={index} className="mb-8">
              <h2 className="text-xl font-semibold mb-4">{section.title}</h2>
              <div className="space-y-6">
                {section.itemCards.map((item) => {
                  const info = item.card.info;
                  return <BestSellerMenuItemCard key={info.id} item={info} />;
                })}
              </div>
            </div>
          );
        }

        if (section?.categories?.length > 0) {
          return section.categories.map((cat, catIndex) => (
            <div key={`${index}-${catIndex}`} className="mb-8">
              <h2 className="text-xl font-semibold mb-4">{cat.title}</h2>
              <div className="space-y-6">
                {cat.itemCards?.map((item) => {
                  const info = item.card.info;
                  return <BestSellerMenuItemCard key={info.id} item={info} />;
                })}
              </div>
            </div>
          ));
        }
        return null;
      })}
    </div>
  );
};

export default RestaurantMenu;
